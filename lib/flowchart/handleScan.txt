â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NgÆ°á»i dÃ¹ng quÃ©t mÃ£ code â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Kiá»ƒm tra tráº¡ng thÃ¡i server   â”‚
     â”‚ (_serverStatus.isConnected)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚
       â–¼                      â–¼
 [ğŸ”Œ OFFLINE MODE]        [ğŸŒ ONLINE MODE]
       â”‚                      â”‚
       â”‚                    Gá»i API:
       â”‚                GET /api/scan/{code}
       â”‚                      â”‚
       â”‚                      â”‚
       â”‚                      â”œâ”€â”€ Náº¿u 200 OK:
       â”‚                      â”‚   â€¢ Parse JSON data
       â”‚                      â”‚   â€¢ Kiá»ƒm tra tráº¡ng thÃ¡i:
       â”‚                      â”‚       - Náº¿u â€œcÃ¢n nháº­pâ€ â†’ bÃ¡o lá»—i náº¿u Ä‘Ã£ nháº­p
       â”‚                      â”‚       - Náº¿u â€œcÃ¢n xuáº¥tâ€ â†’ bÃ¡o lá»—i náº¿u chÆ°a nháº­p / Ä‘Ã£ xuáº¥t
       â”‚                      â”‚   â€¢ LÆ°u cache vÃ o SQLite:
       â”‚                      â”‚       - VmlWork
       â”‚                      â”‚       - VmlPersion
       â”‚                      â”œâ”€â”€ Náº¿u 404 hoáº·c lá»—i khÃ¡c:
       â”‚                      â”‚   â€¢ ThÃ´ng bÃ¡o lá»—i
       â”‚                      â”‚   â€¢ (KhÃ´ng lÆ°u cache)
       â”‚                      â””â”€â”€ Náº¿u timeout hoáº·c lá»—i káº¿t ná»‘i:
       â”‚                          â€¢ Chuyá»ƒn sang OFFLINE MODE
       â”‚
       â–¼
Láº¥y dá»¯ liá»‡u tá»« cache (SQLite):
  â€¢ Báº£ng VmlWorkS (JOIN VmlWork, VmlPersion)
  â€¢ WHERE maCode = {code}
  â€¢ Náº¿u khÃ´ng cÃ³ â†’ bÃ¡o lá»—i â€œKhÃ´ng tÃ¬m tháº¥y mÃ£ offlineâ€
  â€¢ Náº¿u cÃ³ â†’ kiá»ƒm tra:
      - Náº¿u cÃ¢n nháº­p: cháº·n náº¿u Ä‘Ã£ nháº­p
      - Náº¿u cÃ¢n xuáº¥t: cháº·n náº¿u chÆ°a nháº­p / Ä‘Ã£ xuáº¥t
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cáº­p nháº­t state ná»™i bá»™ (UI State):                            â”‚
â”‚  - _activeOVNO, _activeMemo                                  â”‚
â”‚  - _standardWeight, _minWeight, _maxWeight                   â”‚
â”‚  - _activeTotalTargetQty, _activeTotalNhap, _activeTotalXuat â”‚
â”‚  - _records.insert(0, newRecord)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Hiá»ƒn thá»‹ Toast: â€œScan thÃ nh cÃ´ngâ€ â”‚
â”‚ NotificationService().showToast() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
notifyListeners() â†’ UI tá»± Ä‘á»™ng cáº­p nháº­t
