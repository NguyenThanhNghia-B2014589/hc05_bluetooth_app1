â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NgÆ°á»i dÃ¹ng nháº¥n â€œHoÃ n táº¥t cÃ¢nâ€    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Kiá»ƒm tra Ä‘iá»u kiá»‡n ban Ä‘áº§u:     â”‚
     â”‚ - ÄÃ£ scan mÃ£ chÆ°a?              â”‚
     â”‚ - Trá»ng lÆ°á»£ng cÃ³ trong pháº¡m vi? â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                â”‚
          â–¼                â–¼
 [âŒ Sai Ä‘iá»u kiá»‡n]   [âœ… Há»£p lá»‡, tiáº¿p tá»¥c]
          â”‚                â”‚
          â–¼                â”‚
 Hiá»ƒn thá»‹ Toast lá»—i        â”‚
  â†’ return false           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Kiá»ƒm tra tráº¡ng thÃ¡i server   â”‚
              â”‚ (_serverStatus.isConnected)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                    â”‚
             â–¼                                    â–¼
      [ğŸŒ ONLINE MODE]                   [ğŸ”Œ OFFLINE MODE]
             â”‚                                    â”‚
             â”‚  Gá»i API POST:                     â”‚
             â”‚  /api/complete                     â”‚
             â”‚  Body:                             â”‚
             â”‚   {                                â”‚
             â”‚     maCode, khoiLuongCan,          â”‚
             â”‚     thoiGianCan, loai              â”‚
             â”‚   }                                â”‚
             â”‚                                    â”‚
             â”‚  â”œâ”€â”€ Náº¿u status 201:               â”‚
             â”‚  â”‚   â€¢ Parse JSON                  â”‚
             â”‚  â”‚   â€¢ Cáº­p nháº­t summary:           â”‚
             â”‚  â”‚       - totalNhap/Xuat          â”‚
             â”‚  â”‚       - memo                    â”‚
             â”‚  â”‚   â€¢ Update cache (VmlWorkS)     â”‚
             â”‚  â”œâ”€â”€ Náº¿u lá»—i (400, 500...):        â”‚
             â”‚  â”‚   â€¢ Hiá»ƒn thá»‹ Toast lá»—i          â”‚
             â”‚  â””â”€â”€ Náº¿u timeout:                  â”‚
             â”‚      â€¢ BÃ¡o lá»—i káº¿t ná»‘i             â”‚
             â”‚                                    â”‚
             â–¼                                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚     
     â”‚ Cáº­p nháº­t báº£n ghi cá»¥c bá»™:         â”‚         â”‚
     â”‚ currentRecord.isSuccess = true   â”‚         â”‚
     â”‚ currentRecord.realQty = cÃ¢n hiá»‡n â”‚         â”‚
     â”‚ currentRecord.loai = â€œnhap/xuatâ€ â”‚         â”‚
     â”‚ currentRecord.mixTime = now()    â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
             â”‚                                    â”‚
             â–¼                                    â”‚
     Hiá»ƒn thá»‹ Toast: â€œCÃ¢n thÃ nh cÃ´ngâ€             â”‚
             â”‚                                    â”‚
             â–¼                                    â”‚
     notifyListeners() â†’ Cáº­p nháº­t UI              â”‚
                                                  â”‚
                                                  â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ OFFLINE MODE xá»­ lÃ½ riÃªng:      â”‚
                                    â”‚ - Kiá»ƒm tra cache:              â”‚
                                    â”‚   + Náº¿u â€œnhapâ€:                â”‚
                                    â”‚       â€¢ KhÃ´ng trÃ¹ng trong      â”‚
                                    â”‚         HistoryQueue/VmlWorkS  â”‚
                                    â”‚       â€¢ Náº¿u trÃ¹ng â†’ bÃ¡o lá»—i    â”‚
                                    â”‚   + Náº¿u â€œxuatâ€:                â”‚
                                    â”‚       â€¢ Kiá»ƒm tra Ä‘Ã£ cÃ³ nháº­p?   â”‚
                                    â”‚       â€¢ Náº¿u chÆ°a nháº­p â†’ lá»—i    â”‚
                                    â”‚ - Náº¿u há»£p lá»‡:                  â”‚
                                    â”‚   â€¢ Ghi HistoryQueue (Ä‘á»£i sync)â”‚
                                    â”‚   â€¢ Update VmlWorkS (realQty)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                    Hiá»ƒn thá»‹ Toast: â€œCÃ¢n thÃ nh cÃ´ngâ€
                                                      â”‚
                                                      â–¼
                                          notifyListeners()
                                                      â”‚
                                                      â–¼
                                          âœ… Return true
